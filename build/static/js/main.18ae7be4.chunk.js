(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{117:function(t,e,i){},124:function(t,e){},126:function(t,e){},150:function(t,e){},153:function(t,e,i){"use strict";i.r(e);var s,a=i(1),r=i.n(a),n=i(36),c=i.n(n),h=(i(75),i(17)),o=i.n(h),l=i(37),u=i(13),f=i(2),p=i(3),d=i(5),y=i(4),g=i(6),m=i(22),b=(i(78),i(29)),v=function(){function t(){Object(f.a)(this,t),this.zp=new Uint8Array(256).fill(255),this.stack=new Uint8Array(256).fill(255),this.ram=new Uint8Array(1536).fill(255)}return Object(p.a)(t,[{key:"read8",value:function(t){return(t%=2048)<256?this.zp[t]:t<512?this.stack[t-256]:this.ram[t-512]}},{key:"write8",value:function(t,e){(t%=2048)<256?this.zp[t]=e:t<512?this.stack[t-256]=e:this.ram[t-512]=e}}]),t}(),E={NORMAL:0,SPLIT:1},k={ABSOLUTE:0,ABSOLUTE_X:1,ABSOLUTE_Y:2,ACCUMULATOR:3,IMMEDIATE:4,IMPLIED:5,INDEXED_INDIRECT_X:6,INDIRECT:7,INDIRECT_INDEXED_Y:8,RELATIVE:9,ZERO_PAGE:10,ZERO_PAGE_X:11,ZERO_PAGE_Y:12},O={ADC:0,AND:1,ASL:2,BCC:3,BCS:4,BEQ:5,BIT:6,BMI:7,BNE:8,BPL:9,BRK:10,BVC:11,BVS:12,CLC:13,CLD:14,CLI:15,CLV:16,CMP:17,CPX:18,CPY:19,DEC:20,DEX:21,DEY:22,EOR:23,INC:24,INX:25,INY:26,JMP:27,JSR:28,LDA:29,LDX:30,LDY:31,LSR:32,NOP:33,ORA:34,PHA:35,PHP:36,PLA:37,PLP:38,ROL:39,ROR:40,RTI:41,RTS:42,SBC:43,SEC:44,SED:45,SEI:46,STA:47,STX:48,STY:49,TAX:50,TAY:51,TSX:52,TXA:53,TXS:54,TYA:55,ASL_ACC:56,LSR_ACC:57,ROL_ACC:58,ROR_ACC:59,SLO:60},S=0,T=1,w=67,A=88,C=16,B=13,I=38,R=40,L=37,P=39,D=0,j=1,_=2,M=3,N=4,x=5,X=6,U=7,F=[6710886,10888,1315495,3866788,6029438,7209024,7079424,5643520,3355904,739328,20992,20232,16461,0,0,0,11382189,1400793,4342015,7677950,10492620,12000891,11874592,10046976,7040256,3704576,824064,36658,31885,0,0,0,16776959,6598911,9605375,13006591,15952639,16674508,16679280,15375906,12369408,8968192,6087728,4579458,4771294,5197647,0,0,16776959,12640255,13882111,15255807,16499455,16696554,16698565,16242853,15000980,13627286,12448939,11793356,11922418,12105912,0,0],Z=0,G=1,Y=2,z=3,V=4,q=5,K=6,J=7,H=8,W=9,Q=10,$=0,tt=1,et=2,it=3,st={0:[O.BRK,k.IMPLIED,1,7],1:[O.ORA,k.INDEXED_INDIRECT_X,2,6],3:[O.SLO,k.INDEXED_INDIRECT_X,0,8],5:[O.ORA,k.ZERO_PAGE,2,3],6:[O.ASL,k.ZERO_PAGE,2,5],7:[O.SLO,k.ZERO_PAGE,0,5],8:[O.PHP,k.IMPLIED,1,3],9:[O.ORA,k.IMMEDIATE,2,2],10:[O.ASL_ACC,k.ACCUMULATOR,1,2],13:[O.ORA,k.ABSOLUTE,3,4],14:[O.ASL,k.ABSOLUTE,3,6],15:[O.SLO,k.ABSOLUTE,0,6],16:[O.BPL,k.RELATIVE,2,2],17:[O.ORA,k.INDIRECT_INDEXED_Y,2,5],19:[O.SLO,k.INDIRECT_INDEXED_Y,0,8],21:[O.ORA,k.ZERO_PAGE_X,2,4],22:[O.ASL,k.ZERO_PAGE_X,2,6],23:[O.SLO,k.ZERO_PAGE_X,0,6],24:[O.CLC,k.IMPLIED,1,2],25:[O.ORA,k.ABSOLUTE_Y,3,4],27:[O.SLO,k.ABSOLUTE_Y,0,7],29:[O.ORA,k.ABSOLUTE_X,3,4],30:[O.ASL,k.ABSOLUTE_X,3,7],31:[O.SLO,k.ABSOLUTE_X,0,7],32:[O.JSR,k.ABSOLUTE,3,6],33:[O.AND,k.INDEXED_INDIRECT_X,2,6],36:[O.BIT,k.ZERO_PAGE,2,3],37:[O.AND,k.ZERO_PAGE,2,3],38:[O.ROL,k.ZERO_PAGE,2,5],40:[O.PLP,k.IMPLIED,1,4],41:[O.AND,k.IMMEDIATE,2,2],42:[O.ROL_ACC,k.ACCUMULATOR,1,2],44:[O.BIT,k.ABSOLUTE,3,4],45:[O.AND,k.ABSOLUTE,3,4],46:[O.ROL,k.ABSOLUTE,3,6],48:[O.BMI,k.RELATIVE,2,2],49:[O.AND,k.INDIRECT_INDEXED_Y,2,5],53:[O.AND,k.ZERO_PAGE_X,2,4],54:[O.ROL,k.ZERO_PAGE_X,2,6],56:[O.SEC,k.IMPLIED,1,2],57:[O.AND,k.ABSOLUTE_Y,3,4],61:[O.AND,k.ABSOLUTE_X,3,4],62:[O.ROL,k.ABSOLUTE_X,3,7],64:[O.RTI,k.IMPLIED,1,6],65:[O.EOR,k.INDEXED_INDIRECT_X,2,6],69:[O.EOR,k.ZERO_PAGE,2,3],70:[O.LSR,k.ZERO_PAGE,2,5],72:[O.PHA,k.IMPLIED,1,3],73:[O.EOR,k.IMMEDIATE,2,2],74:[O.LSR_ACC,k.ACCUMULATOR,1,2],76:[O.JMP,k.ABSOLUTE,3,3],77:[O.EOR,k.ABSOLUTE,3,4],78:[O.LSR,k.ABSOLUTE,3,6],80:[O.BVC,k.RELATIVE,2,2],81:[O.EOR,k.INDIRECT_INDEXED_Y,2,5],85:[O.EOR,k.ZERO_PAGE_X,2,4],86:[O.LSR,k.ZERO_PAGE_X,2,6],88:[O.CLI,k.IMPLIED,1,2],89:[O.EOR,k.ABSOLUTE_Y,3,4],93:[O.EOR,k.ABSOLUTE_X,3,4],94:[O.LSR,k.ABSOLUTE_X,3,7],96:[O.RTS,k.IMPLIED,1,6],97:[O.ADC,k.INDEXED_INDIRECT_X,2,6],101:[O.ADC,k.ZERO_PAGE,2,3],102:[O.ROR,k.ZERO_PAGE,2,5],104:[O.PLA,k.IMPLIED,1,4],105:[O.ADC,k.IMMEDIATE,2,2],106:[O.ROR_ACC,k.ACCUMULATOR,1,2],108:[O.JMP,k.INDIRECT,3,5],109:[O.ADC,k.ABSOLUTE,3,4],110:[O.ROR,k.ABSOLUTE,3,6],112:[O.BVS,k.RELATIVE,2,2],113:[O.ADC,k.INDIRECT_INDEXED_Y,2,5],117:[O.ADC,k.ZERO_PAGE_X,2,4],118:[O.ROR,k.ZERO_PAGE_X,2,6],120:[O.SEI,k.IMPLIED,1,2],121:[O.ADC,k.ABSOLUTE_Y,3,4],125:[O.ADC,k.ABSOLUTE_X,3,4],126:[O.ROR,k.ABSOLUTE_X,3,7],129:[O.STA,k.INDEXED_INDIRECT_X,2,6],132:[O.STY,k.ZERO_PAGE,2,3],133:[O.STA,k.ZERO_PAGE,2,3],134:[O.STX,k.ZERO_PAGE,2,3],136:[O.DEY,k.IMPLIED,1,2],138:[O.TXA,k.IMPLIED,1,2],140:[O.STY,k.ABSOLUTE,3,4],141:[O.STA,k.ABSOLUTE,3,4],142:[O.STX,k.ABSOLUTE,3,4],144:[O.BCC,k.RELATIVE,2,2],145:[O.STA,k.INDIRECT_INDEXED_Y,2,6],148:[O.STY,k.ZERO_PAGE_X,2,4],149:[O.STA,k.ZERO_PAGE_X,2,4],150:[O.STX,k.ZERO_PAGE_Y,2,4],152:[O.TYA,k.IMPLIED,1,2],153:[O.STA,k.ABSOLUTE_Y,3,5],154:[O.TXS,k.IMPLIED,1,2],157:[O.STA,k.ABSOLUTE_X,3,5],160:[O.LDY,k.IMMEDIATE,2,2],161:[O.LDA,k.INDEXED_INDIRECT_X,2,6],162:[O.LDX,k.IMMEDIATE,2,2],164:[O.LDY,k.ZERO_PAGE,2,3],165:[O.LDA,k.ZERO_PAGE,2,3],166:[O.LDX,k.ZERO_PAGE,2,3],168:[O.TAY,k.IMPLIED,1,2],169:[O.LDA,k.IMMEDIATE,2,2],170:[O.TAX,k.IMPLIED,1,2],172:[O.LDY,k.ABSOLUTE,3,4],173:[O.LDA,k.ABSOLUTE,3,4],174:[O.LDX,k.ABSOLUTE,3,4],176:[O.BCS,k.RELATIVE,2,2],177:[O.LDA,k.INDIRECT_INDEXED_Y,2,5],180:[O.LDY,k.ZERO_PAGE_X,2,4],181:[O.LDA,k.ZERO_PAGE_X,2,4],182:[O.LDX,k.ZERO_PAGE_Y,2,4],184:[O.CLV,k.IMPLIED,1,2],185:[O.LDA,k.ABSOLUTE_Y,3,4],186:[O.TSX,k.IMPLIED,1,2],188:[O.LDY,k.ABSOLUTE_X,3,4],189:[O.LDA,k.ABSOLUTE_X,3,4],190:[O.LDX,k.ABSOLUTE_Y,3,4],192:[O.CPY,k.IMMEDIATE,2,2],193:[O.CMP,k.INDEXED_INDIRECT_X,2,6],196:[O.CPY,k.ZERO_PAGE,2,3],197:[O.CMP,k.ZERO_PAGE,2,3],198:[O.DEC,k.ZERO_PAGE,2,5],199:[O.DCP,k.ZERO_PAGE,0,5],200:[O.INY,k.IMPLIED,1,2],201:[O.CMP,k.IMMEDIATE,2,2],202:[O.DEX,k.IMPLIED,1,2],204:[O.CPY,k.ABSOLUTE,3,4],205:[O.CMP,k.ABSOLUTE,3,4],206:[O.DEC,k.ABSOLUTE,3,6],208:[O.BNE,k.RELATIVE,2,2],209:[O.CMP,k.INDIRECT_INDEXED_Y,2,5],213:[O.CMP,k.ZERO_PAGE_X,2,4],214:[O.DEC,k.ZERO_PAGE_X,2,6],216:[O.CLD,k.IMPLIED,1,2],217:[O.CMP,k.ABSOLUTE_Y,3,4],221:[O.CMP,k.ABSOLUTE_X,3,4],222:[O.DEC,k.ABSOLUTE_X,3,7],224:[O.CPX,k.IMMEDIATE,2,2],225:[O.SBC,k.INDEXED_INDIRECT_X,2,6],228:[O.CPX,k.ZERO_PAGE,2,3],229:[O.SBC,k.ZERO_PAGE,2,3],230:[O.INC,k.ZERO_PAGE,2,5],232:[O.INX,k.IMPLIED,1,2],233:[O.SBC,k.IMMEDIATE,2,2],234:[O.NOP,k.IMPLIED,1,2],235:[O.SBC,k.IMMEDIATE,2,2],236:[O.CPX,k.ABSOLUTE,3,4],237:[O.SBC,k.ABSOLUTE,3,4],238:[O.INC,k.ABSOLUTE,3,6],239:[O.ISC,k.ABSOLUTE,0,6],240:[O.BEQ,k.RELATIVE,2,2],241:[O.SBC,k.INDIRECT_INDEXED_Y,2,5],245:[O.SBC,k.ZERO_PAGE_X,2,4],246:[O.INC,k.ZERO_PAGE_X,2,6],247:[O.ISC,k.ZERO_PAGE_X,0,6],248:[O.SED,k.IMPLIED,1,2],249:[O.SBC,k.ABSOLUTE_Y,3,4],253:[O.SBC,k.ABSOLUTE_X,3,4],254:[O.INC,k.ABSOLUTE_X,3,7]},at=i(0);function rt(t,e){return t>>8!==e>>8}var nt,ct=(s={},Object(at.a)(s,k.IMMEDIATE,function(t){return t.pc+1}),Object(at.a)(s,k.ABSOLUTE,function(t){return t.read16(t.pc+1)}),Object(at.a)(s,k.ABSOLUTE_X,function(t){var e=t.read16(t.pc+1)+t.x&65535;return rt(e-t.x,e)&&(t.b=1),e}),Object(at.a)(s,k.ABSOLUTE_Y,function(t){var e=t.read16(t.pc+1)+t.y&65535;return rt(e-t.y,e)&&(t.b=1),e}),Object(at.a)(s,k.ACCUMULATOR,function(t){return t.a}),Object(at.a)(s,k.IMPLIED,function(t){return 0}),Object(at.a)(s,k.RELATIVE,function(t){var e=t.read8(t.pc+1);return e<128?e+t.pc+2:e+t.pc+2-256}),Object(at.a)(s,k.ZERO_PAGE_Y,function(t){return t.read8(t.pc+1)+t.y&255}),Object(at.a)(s,k.ZERO_PAGE_X,function(t){return t.read8(t.pc+1)+t.x&255}),Object(at.a)(s,k.ZERO_PAGE,function(t){return t.read8(t.pc+1)}),Object(at.a)(s,k.INDEXED_INDIRECT_X,function(t){return t.read16indirect(t.read8(t.pc+1)+t.x&255)}),Object(at.a)(s,k.INDIRECT_INDEXED_Y,function(t){var e=t.read16indirect(t.read8(t.pc+1))+t.y&65535;return rt(e-t.y,e)&&(t.b=1),e}),Object(at.a)(s,k.INDIRECT,function(t){return t.read16indirect(t.read16(t.pc+1))}),s),ht=(nt={},Object(at.a)(nt,O.ADC,function(t,e){var i=e.a,s=e.read8(t);e.a=i+s+e.c,e.a>255?e.c=1:e.c=0,e.a=255&e.a,(i^e.a)&(s^e.a)&128?e.v=1:e.v=0,e.setNegativeFlag(e.a),e.setZeroFlag(e.a),e.cycles+=e.b}),Object(at.a)(nt,O.SEI,function(t,e){e.i=1}),Object(at.a)(nt,O.CLC,function(t,e){e.c=0}),Object(at.a)(nt,O.CLV,function(t,e){e.v=0}),Object(at.a)(nt,O.TSX,function(t,e){e.x=e.sp,e.setNegativeFlag(e.x),e.setZeroFlag(e.x)}),Object(at.a)(nt,O.TAX,function(t,e){e.x=e.a,e.setNegativeFlag(e.x),e.setZeroFlag(e.x)}),Object(at.a)(nt,O.PLA,function(t,e){e.a=e.stackPull8(),e.setNegativeFlag(e.a),e.setZeroFlag(e.a)}),Object(at.a)(nt,O.DEC,function(t,e){var i=e.read8(t);i=i-1&255,e.setNegativeFlag(i),e.setZeroFlag(i),e.write8(t,i)}),Object(at.a)(nt,O.DEY,function(t,e){e.y=e.y-1&255,e.setNegativeFlag(e.y),e.setZeroFlag(e.y)}),Object(at.a)(nt,O.DEX,function(t,e){e.x=e.x-1&255,e.setZeroFlag(e.x),e.setNegativeFlag(e.x)}),Object(at.a)(nt,O.TXS,function(t,e){e.sp=e.x}),Object(at.a)(nt,O.TXA,function(t,e){e.a=e.x,e.setZeroFlag(e.a),e.setNegativeFlag(e.a)}),Object(at.a)(nt,O.CLD,function(t,e){e.d=0}),Object(at.a)(nt,O.PHP,function(t,e){e.stackPush8(16|e.getFlags())}),Object(at.a)(nt,O.BRK,function(t,e){e.stackPush16(e.pc+1),e.stackPush8(24|e.getFlags()),e.i=1,e.pc=e.read16(65534)}),Object(at.a)(nt,O.JSR,function(t,e){e.stackPush16(e.pc-1),e.pc=65535&t}),Object(at.a)(nt,O.BVC,function(t,e){0===e.v&&(e.cycles+=rt(e.pc,t)?2:1,e.pc=65535&t)}),Object(at.a)(nt,O.BVS,function(t,e){1===e.v&&(e.cycles+=rt(e.pc,t)?2:1,e.pc=65535&t)}),Object(at.a)(nt,O.BEQ,function(t,e){1===e.z&&(e.cycles+=rt(e.pc,t)?2:1,e.pc=65535&t)}),Object(at.a)(nt,O.BCS,function(t,e){1===e.c&&(e.cycles+=rt(e.pc,t)?2:1,e.pc=65535&t)}),Object(at.a)(nt,O.BNE,function(t,e){0===e.z&&(e.cycles+=rt(e.pc,t)?2:1,e.pc=65535&t)}),Object(at.a)(nt,O.BCC,function(t,e){0===e.c&&(e.cycles+=rt(e.pc,t)?2:1,e.pc=65535&t)}),Object(at.a)(nt,O.BPL,function(t,e){0===e.n&&(e.cycles+=rt(e.pc,t)?2:1,e.pc=65535&t)}),Object(at.a)(nt,O.BMI,function(t,e){1===e.n&&(e.cycles+=rt(e.pc,t)?2:1,e.pc=65535&t)}),Object(at.a)(nt,O.SED,function(t,e){e.d=1}),Object(at.a)(nt,O.SEC,function(t,e){e.c=1}),Object(at.a)(nt,O.RTI,function(t,e){e.setFlags(32|e.stackPull8()),e.pc=e.stackPull16()}),Object(at.a)(nt,O.AND,function(t,e){var i=e.read8(t);e.a=e.a&i,e.setNegativeFlag(e.a),e.setZeroFlag(e.a),e.cycles+=e.b}),Object(at.a)(nt,O.TAY,function(t,e){e.y=e.a,e.setNegativeFlag(e.y),e.setZeroFlag(e.y)}),Object(at.a)(nt,O.LDA,function(t,e){e.a=e.read8(t),e.setNegativeFlag(e.a),e.setZeroFlag(e.a),e.cycles+=e.b}),Object(at.a)(nt,O.LDY,function(t,e){e.y=e.read8(t),e.setNegativeFlag(e.y),e.setZeroFlag(e.y),e.cycles+=e.b}),Object(at.a)(nt,O.LDX,function(t,e){e.x=e.read8(t),e.setNegativeFlag(e.x),e.setZeroFlag(e.x),e.cycles+=e.b}),Object(at.a)(nt,O.STX,function(t,e){e.write8(t,e.x)}),Object(at.a)(nt,O.STY,function(t,e){e.write8(t,e.y)}),Object(at.a)(nt,O.STA,function(t,e){e.write8(t,e.a)}),Object(at.a)(nt,O.CMP,function(t,e){var i=e.read8(t),s=e.a-i;e.a>=i?e.c=1:e.c=0,e.setNegativeFlag(s),e.setZeroFlag(s),e.cycles+=e.b}),Object(at.a)(nt,O.CPX,function(t,e){var i=e.read8(t),s=e.x-i;e.x>=i?e.c=1:e.c=0,e.setNegativeFlag(s),e.setZeroFlag(s)}),Object(at.a)(nt,O.CPY,function(t,e){var i=e.read8(t),s=e.y-i;e.y>=i?e.c=1:e.c=0,e.setNegativeFlag(s),e.setZeroFlag(s)}),Object(at.a)(nt,O.ASL_ACC,function(t,e){e.c=e.a>>7&1,e.a=e.a<<1&255,e.setZeroFlag(e.a),e.setNegativeFlag(e.a)}),Object(at.a)(nt,O.ASL,function(t,e){var i=e.read8(t);e.c=i>>7&1,i=i<<1&255,e.setZeroFlag(i),e.setNegativeFlag(i),e.write8(t,i)}),Object(at.a)(nt,O.SBC,function(t,e){var i=e.a,s=e.read8(t),a=e.c;e.a=e.a-s-(1-e.c)&255,e.setNegativeFlag(e.a),e.setZeroFlag(e.a),e.c=i-s-(1-a)>=0?1:0,(i^e.a)&(s^e.a)&128?e.v=1:e.v=0,e.cycles+=e.b}),Object(at.a)(nt,O.EOR,function(t,e){var i=e.read8(t);e.a=255&(e.a^i),e.setZeroFlag(e.a),e.setNegativeFlag(e.a),e.cycles+=e.b}),Object(at.a)(nt,O.RTS,function(t,e){e.pc=e.stackPull16()+1}),Object(at.a)(nt,O.INY,function(t,e){e.y=e.y+1&255,e.setNegativeFlag(e.y),e.setZeroFlag(e.y)}),Object(at.a)(nt,O.INX,function(t,e){e.x=e.x+1&255,e.setNegativeFlag(e.x),e.setZeroFlag(e.x)}),Object(at.a)(nt,O.INC,function(t,e){var i=e.read8(t)+1&255;e.setNegativeFlag(i),e.setZeroFlag(i),e.write8(t,i)}),Object(at.a)(nt,O.PHA,function(t,e){e.stackPush8(e.a)}),Object(at.a)(nt,O.PLP,function(t,e){e.setFlags(239&e.stackPull8()|32)}),Object(at.a)(nt,O.ORA,function(t,e){e.a=e.a|e.read8(t),e.setNegativeFlag(e.a),e.setZeroFlag(e.a),e.cycles+=e.b}),Object(at.a)(nt,O.LSR_ACC,function(t,e){e.c=1&e.a,e.a=e.a>>1,e.setNegativeFlag(e.a),e.setZeroFlag(e.a)}),Object(at.a)(nt,O.LSR,function(t,e){var i=e.read8(t);e.c=1&i,i>>=1,e.write8(t,i),e.setNegativeFlag(i),e.setZeroFlag(i)}),Object(at.a)(nt,O.TYA,function(t,e){e.a=e.y,e.setNegativeFlag(e.a),e.setZeroFlag(e.a)}),Object(at.a)(nt,O.ROL_ACC,function(t,e){var i=e.c;e.c=e.a>>7&1,e.a=e.a<<1&255|i,e.setNegativeFlag(e.a),e.setZeroFlag(e.a)}),Object(at.a)(nt,O.ROL,function(t,e){var i=e.c,s=e.read8(t);e.c=s>>7&1,s=s<<1&255|i,e.write8(t,s),e.setNegativeFlag(s),e.setZeroFlag(s)}),Object(at.a)(nt,O.ROR_ACC,function(t,e){var i=e.c;e.c=1&e.a,e.a=(e.a>>1)+(i<<7),e.setNegativeFlag(e.a),e.setZeroFlag(e.a)}),Object(at.a)(nt,O.ROR,function(t,e){var i=e.c,s=e.read8(t);e.c=1&s,s=(s>>1)+(i<<7),e.write8(t,s),e.setNegativeFlag(s),e.setZeroFlag(s)}),Object(at.a)(nt,O.BIT,function(t,e){var i=e.read8(t);e.v=i>>6&1,e.setZeroFlag(i&e.a),e.setNegativeFlag(i)}),Object(at.a)(nt,O.JMP,function(t,e){e.pc=65535&t}),Object(at.a)(nt,O.CLI,function(t,e){e.i=0}),Object(at.a)(nt,O.NOP,function(t,e){}),Object(at.a)(nt,O.ISC,function(t,e){}),nt),ot=function(){function t(){Object(f.a)(this,t),this.memory=new v,this.mapper=null,this.apu=null,this.ppu=null,this.controller=null,this.cycles=0,this.b=0,this.pc=0,this.sp=0,this.a=0,this.x=0,this.y=0,this.c=0,this.z=0,this.i=0,this.d=0,this.v=0,this.n=0,this.interrupt=null,this._modes=ct,this._instructions=st,this._opcodes=ht,this.stallCounter=0,this.tmpCycles=0,this.instrCycles=0,this.instrCode=0,this.lastInstrCode=0,this.instrOpCode=0,this.instrMode=0,this.instrSize=0,this.addr=0}return Object(p.a)(t,[{key:"loadJSON",value:function(t){}},{key:"connect",value:function(t,e,i){this.apu=t,this.ppu=e,this.controller=i}},{key:"connectROM",value:function(t){}},{key:"stall",value:function(){this.cycles%2===1?this.stallCounter+=514:this.stallCounter+=513}},{key:"reset",value:function(){this.cycles=0,this.a=0,this.x=0,this.y=0,this.interrupt=null,this.stallCounter=0,this.pc=this.read16(65532),this.sp=253,this.setFlags(36)}},{key:"tick",value:function(){if(this.tmpCycles=this.cycles,this.b=0,this.stallCounter>0)return this.stallCounter--,0;if(null!==this.interrupt){switch(this.interrupt){case S:this.stackPush16(this.pc),this.stackPush8(-17&this.getFlags()),this.pc=this.read16(65530),this.i=1,this.cycles+=7;break;case T:0===this.i&&(this.stackPush16(this.pc),this.stackPush8(-17&this.getFlags()),this.pc=this.read16(65534),this.i=1,this.cycles+=7)}return this.interrupt=null,7}try{this.instrCode=this.read8(this.pc)}catch(e){throw new Error("Could not read next instruction: "+e)}if(255===this.instrCode||64===this.instrCode&&this.instrCode===this.lastInstrCode)return-1;var t=Object(b.a)(this._instructions[this.instrCode],4);return this.instrOpCode=t[0],this.instrMode=t[1],this.instrSize=t[2],this.instrCycles=t[3],this.addr=this._modes[this.instrMode](this),this.pc+=this.instrSize,this.cycles+=this.instrCycles,this._opcodes[this.instrOpCode](this.addr,this),this.lastInstrCode=this.instrCode,this.cycles-this.tmpCycles}},{key:"triggerNMI",value:function(){this.interrupt=S}},{key:"triggerIRQ",value:function(){this.interrupt=T}},{key:"read8",value:function(t){return t<8192?this.memory.read8(t):t<16384?this.ppu.read8(8192+t%8):16404===t?this.ppu.read8(t):16405===t?this.apu.read8():16406===t?this.controller.read8():16407===t?0:t<24576?(console.log("I/O REGISTERS"),0):this.ppu.memory.mapper.read8(t)}},{key:"read16",value:function(t){return this.read8(t+1)<<8|this.read8(t)}},{key:"read16indirect",value:function(t){var e=65280&t|1+(255&t)&255,i=this.read8(t);return this.read8(e)<<8|i}},{key:"write8",value:function(t,e){if(t<8192)this.memory.write8(t,e);else if(t<16384)this.ppu.write8(8192+t%8,e);else if(16404===t){t=e<<8,this.ppu.tmpOamAddress=this.ppu.oamAddress;for(var i=0;i<256;i++)this.ppu.memory.oam[this.ppu.oamAddress]=this.read8(t),this.ppu.oamAddress++,t++;this.ppu.oamAddress=this.ppu.tmpOamAddress,this.stall()}else 16405===t?this.apu.write8(t,e):16406===t?this.controller.write8(e):16407===t||t>=24576&&this.ppu.memory.mapper.write8(t,e)}},{key:"stackPush8",value:function(t){this.memory.stack[this.sp]=t,this.sp=this.sp-1&255}},{key:"stackPush16",value:function(t){this.stackPush8(t>>8),this.stackPush8(255&t)}},{key:"stackPull8",value:function(t){return this.sp=this.sp+1&255,this.memory.stack[this.sp]}},{key:"stackPull16",value:function(t){return this.stackPull8()|this.stackPull8()<<8}},{key:"setZeroFlag",value:function(t){this.z=0===t?1:0}},{key:"setNegativeFlag",value:function(t){this.n=0!==(128&t)?1:0}},{key:"getFlags",value:function(){var t=0;return t|=this.c<<0,t|=this.z<<1,t|=this.i<<2,t|=this.d<<3,t|=0,t|=32,t|=this.v<<6,t|=this.n<<7}},{key:"setFlags",value:function(t){this.c=t>>0&1,this.z=t>>1&1,this.i=t>>2&1,this.d=t>>3&1,this.v=t>>6&1,this.n=t>>7&1}}]),t}(),lt=function(){function t(){Object(f.a)(this,t),this.data=new Uint8Array(2048).fill(0),this.mirrors=[[0,0,1,1],[0,1,0,1],[0,0,0,0],[1,1,1,1],[0,1,2,3]]}return Object(p.a)(t,[{key:"flush",value:function(){this.data.fill(0)}},{key:"_resolve",value:function(t,e){return e%=4096,1024*this.mirrors[t][parseInt(e/1024)]+e%1024}},{key:"read8",value:function(t,e){return this.data[this._resolve(t,e)]}},{key:"write8",value:function(t,e,i){this.data[this._resolve(t,e)]=i}}]),t}(),ut=function(){function t(){Object(f.a)(this,t),this.data=new Uint8Array(32).fill(0)}return Object(p.a)(t,[{key:"flush",value:function(){this.data.fill(0)}},{key:"write8",value:function(t,e){(t%=32)%4===0&&t>=16&&(t-=16),this.data[t]=e}},{key:"read8",value:function(t){return(t%=32)%4===0&&t>=16&&(t-=16),this.data[t]}}]),t}(),ft=function(){function t(){Object(f.a)(this,t),this.paletteTable=new ut,this.oam=new Uint8Array(256).fill(0),this.nameTable=new lt,this.mapper=null}return Object(p.a)(t,[{key:"flush",value:function(){this.paletteTable.flush(),this.oam.fill(0),this.nameTable.flush()}},{key:"write8",value:function(t,e){if((t%=16384)<8192)this.mapper.write8(t,e);else if(t<16128)this.nameTable.write8(this.mapper.mirrorType,t,e);else{if(!(t<16384))throw new Error("Unknown PPU addr "+t);this.paletteTable.write8(t,e)}}},{key:"readNametable",value:function(t){return t%=16384,this.nameTable.read8(this.mapper.mirrorType,t)}},{key:"read8",value:function(t){if((t%=16384)<8192)return this.mapper.read8(t);if(t<16128)return this.nameTable.read8(this.mapper.mirrorType,t);if(!(t<16384))throw new Error("Unknown PPU addr "+t);this.paletteTable.read8(t)}}]),t}(),pt=function(){function t(){Object(f.a)(this,t),this.memory=new ft,this.cycle=0,this.cycleType=null,this.scanline=261,this.scanlineType=null,this.interrupt=null,this.v=0,this.t=0,this.y=0,this.x=0,this.w=0,this.f=0,this.register=0,this.nmiOccurred=0,this.nmiOutput=0,this.backgroundTileBuffer=[],this.lowTileByte=0,this.highTileByte=0,this.attributeTableByte=0,this.spriteCount=0,this.sprites=new Array(8);for(var e=0;e<8;e++)this.sprites[e]={buffer:[],x:null,priority:null,index:null};this.registerRead=0,this.registerBuffer=0,this.fNameTable=0,this.fIncrement=0,this.fSpriteTable=0,this.fBackgroundTable=0,this.fSpriteSize=0,this.fMasterSlave=0,this.fGrayscale=0,this.fShowLeftBackground=0,this.fShowLeftSprites=0,this.fShowBackground=0,this.fShowSprites=0,this.fRedTint=0,this.fGreenTint=0,this.fBlueTint=0,this.fSpriteZeroHit=0,this.fSpriteOverflow=0,this.tmpOamAddress=0,this.oamAddress=0,this.bufferedData=0,this.backgroundColor=0,this.spriteColor=0,this.spriteIndex=0,this.isBackgroundPixel=!0,this.backgroundPixel=0,this.spritePixel=0,this.color=0,this.setRenderingMode(E.NORMAL),this.resetBuffers(),this.frameReady=!1,this.patternTable1=new Uint8Array(102400).fill(255),this.patternTable2=new Uint8Array(102400).fill(255),this.oamTable=new Uint8Array(51200),this.patternTablesColors=[[255,255,255],[51,51,51],[191,191,191],[0,0,0]]}return Object(p.a)(t,[{key:"connectROM",value:function(t){this.memory.mapper=t.mapper}},{key:"resetBuffers",value:function(){this.frameBuffer=new Uint8Array(245760).fill(0),this.frameBackgroundBuffer=new Uint8Array(245760).fill(0),this.frameSpriteBuffer=new Uint8Array(245760).fill(0),this.frameColorBuffer=new Uint32Array(61440).fill(0)}},{key:"_parsePatternTable",value:function(t,e,i){for(var s=null,a=0,r=0,n=0,c=t,h=0,o=0,l=0;c<e;){for(a=this.memory.read8(c),r=this.memory.read8(c+8),o=0;o<8;)s=((a>>o&1)<<1)+(r>>o&1),n=c%8*160,n+=160*h,n+=7-o,n+=l%16*10,i[n*=4]=this.patternTablesColors[s][0],i[n+1]=this.patternTablesColors[s][1],i[n+2]=this.patternTablesColors[s][2],i[n+3]=255,o++;c%256===0&&c>t&&(h+=10),++c%8===0&&(c+=8,l++)}return i}},{key:"getPatternTables",value:function(){return[this._parsePatternTable(0,4096,this.patternTable1),this._parsePatternTable(4096,8192,this.patternTable2)]}},{key:"getOamTable",value:function(){var t,e,i,s,a,r,n,c,h,o,l,u,f,p;o=0,this.oamTable.fill(255);for(var d=0;d<64;d++)if(t=this.memory.oam[4*d+1],i=this.getSpriteSize(),0===this.fSpriteSize?e=this.fSpriteTable:(e=1&t,t&=254),a=4096*e+16*t,f=128===(128&(s=this.memory.oam[4*d+2])),p=64===(64&s),0!==t){for(var y=0;y<i;y++){r=this.memory.read8(a),n=this.memory.read8(a+8),h=f?i-1-y:y;for(var g=0;g<8;g++)l=r>>(c=p?7-g:g)&1|(n>>c&1)<<1,u=80*h,u+=80*o,u+=7-g,u+=d%8*8+d%8*2,u*=4,this.oamTable[u]=this.patternTablesColors[l][0],this.oamTable[u+1]=this.patternTablesColors[l][1],this.oamTable[u+2]=this.patternTablesColors[l][2],this.oamTable[u+3]=255;a++,0!==this.fSpriteSize&&7===y&&(a=4096*e+16*++t)}d%8===0&&d>0&&(o+=18)}return this.oamTable}},{key:"reset",value:function(){this.memory.flush(),this.cycle=0,this.scanline=261,this.v=0,this.t=0,this.x=0,this.w=0,this.f=0,this.register=0,this.nmiOccurred=0,this.nmiOutput=0,this.lowTileByte=0,this.highTileByte=0,this.tileData=[],this.spriteCount=0,this.fNameTable=0,this.fIncrement=0,this.fSpriteTable=0,this.fBackgroundTable=0,this.fSpriteSize=0,this.fMasterSlave=0,this.fGrayscale=0,this.fShowLeftBackground=0,this.fShowLeftSprites=0,this.fShowBackground=0,this.fShowSprites=0,this.fRedTint=0,this.fGreenTint=0,this.fBlueTint=0,this.fSpriteZeroHit=0,this.fSpriteOverflow=0,this.oamAddress=0,this.bufferedData=0,this.frameBuffer.fill(0),this.frameReady=!1}},{key:"setRenderingMode",value:function(t){var e;this.renderingMode=(e={},Object(at.a)(e,E.NORMAL,this.normalRenderingMode),Object(at.a)(e,E.SPLIT,this.splitRenderingMode),e)[t]}},{key:"getSpriteSize",value:function(){return this.fSpriteSize?16:8}},{key:"read8",value:function(t){switch(t){case 8194:return this.registerRead=31&this.register,this.registerRead=this.registerRead|this.fSpriteOverflow<<5,this.registerRead=this.registerRead|this.fSpriteZeroHit<<6,this.nmiOccurred&&(2===this.cycle&&241===this.scanline||(this.registerRead=128|this.registerRead)),this.nmiOccurred=0,this.w=0,this.registerRead;case 8196:return this.memory.oam[this.oamAddress];case 8199:return this.registerRead=this.memory.read8(this.v),this.v%16384<16128?(this.registerBuffer=this.bufferedData,this.bufferedData=this.registerRead,this.registerRead=this.registerBuffer):this.bufferedData=this.memory.read8(this.v-4096),0===this.fIncrement?this.v+=1:this.v+=32,this.registerRead}return 0}},{key:"write8",value:function(t,e,i){switch(this.register=e,t){case 8192:this.fNameTable=e>>0&3,this.fIncrement=e>>2&1,this.fSpriteTable=e>>3&1,this.fBackgroundTable=e>>4&1,this.fSpriteSize=e>>5&1,this.fMasterSlave=e>>6&1,this.nmiOutput=1===(e>>7&1),this.t=62463&this.t|(3&e)<<10;break;case 8193:this.fGrayscale=e>>0&1,this.fShowLeftBackground=e>>1&1,this.fShowLeftSprites=e>>2&1,this.fShowBackground=e>>3&1,this.fShowSprites=e>>4&1,this.fRedTint=e>>5&1,this.fGreenTint=e>>6&1,this.fBlueTint=e>>7&1;break;case 8195:this.oamAddress=e;break;case 8196:this.memory.oam[this.oamAddress]=e,this.oamAddress++;break;case 8197:0===this.w?(this.t=65504&this.t|e>>3,this.x=7&e,this.w=1):(this.t=36863&this.t|(7&e)<<12,this.t=64543&this.t|(248&e)<<2,this.w=0);break;case 8198:0===this.w?(this.t=33023&this.t|(63&e)<<8,this.w=1):(this.t=65280&this.t|e,this.v=this.t,this.w=0);break;case 8199:this.memory.write8(this.v,e),0===this.fIncrement?this.v+=1:this.v+=32}}},{key:"updateScrollingX",value:function(){31===(31&this.v)?(this.v=65504&this.v,this.v=1024^this.v):this.v++}},{key:"updateScrollingY",value:function(){this.cycleType===J&&(28672!==(28672&this.v)?this.v+=4096:(this.v=36863&this.v,this.y=(992&this.v)>>5,29===this.y?(this.y=0,this.v=2048^this.v):31===this.y?this.y=0:this.y++,this.v=64543&this.v|this.y<<5)),this.cycleType===K&&(this.v=64480&this.v|1055&this.t)}},{key:"setVerticalBlank",value:function(){this.nmiOccurred=1}},{key:"clearVerticalBlank",value:function(){this.nmiOccurred=0,this.frameReady=!0}},{key:"acknowledgeFrame",value:function(){this.frameReady=!1,1===this.fShowSprites&&(this.fSpriteOverflow=0,this.fSpriteZeroHit=0),this.frameBackgroundBuffer.fill(0),this.frameSpriteBuffer.fill(0)}},{key:"getCurrentBackgroundPixel",value:function(){return 0===this.fShowBackground?0:15&this.backgroundTileBuffer[this.x]}},{key:"getCurrentSpritePixel",value:function(){var t,e;if(0===this.fShowSprites)return[0,0];for(var i=0;i<this.spriteCount;i++)if(!((e=this.cycle-1-this.sprites[i].x)<0||e>7)&&(t=15&this.sprites[i].buffer[e])%4!==0)return[i,16|t];return[0,0]}},{key:"setColorToBuffer",value:function(t,e,i){t[e]=i>>16&255,t[e+1]=i>>8&255,t[e+2]=255&i,t[e+3]=255}},{key:"normalRenderingMode",value:function(t,e,i){this.setColorToBuffer(this.frameBuffer,e,i)}},{key:"splitRenderingMode",value:function(t,e,i){this.frameColorBuffer[t]=i,this.isBackgroundPixel?this.setColorToBuffer(this.frameBackgroundBuffer,e,i):(this.setColorToBuffer(this.frameSpriteBuffer,e,i),this.setColorToBuffer(this.frameBackgroundBuffer,e,0))}},{key:"renderPixel",value:function(){var t=this.cycle-1,e=256*this.scanline+t;this.isBackgroundPixel=!0,this.color=0,this.backgroundColor=t<8&&0===this.fShowLeftBackground?0:this.getCurrentBackgroundPixel();var i=t<8&&0===this.fShowLeftSprites?[0,0]:this.getCurrentSpritePixel(),s=Object(b.a)(i,2);this.spriteIndex=s[0],this.spriteColor=s[1],this.backgroundPixel=this.backgroundColor%4,this.spritePixel=this.spriteColor%4,0===this.backgroundPixel&&0===this.spritePixel?this.color=0:0===this.backgroundPixel&&0!==this.spritePixel?(this.color=this.spriteColor,this.isBackgroundPixel=!1):0!==this.backgroundPixel&&0===this.spritePixel?this.color=this.backgroundColor:(0===this.sprites[this.spriteIndex].index&&t<255&&(this.fSpriteZeroHit=1),0===this.sprites[this.spriteIndex].priority?(this.color=this.spriteColor,this.isBackgroundPixel=!1):this.color=this.backgroundColor),this.renderingMode(e,4*e,F[this.memory.paletteTable.read8(this.color)])}},{key:"readTileRow",value:function(t,e,i,s,a,r){var n=0,c=0;r&&(t.length=0);for(var h=0;h<8;h++)c=e|i>>(n=a?h:7-h)&1|(s>>n&1)<<1,t.push(c)}},{key:"fetchSpriteRow",value:function(t,e,i){var s,a=this.memory.oam[4*e+1],r=this.memory.oam[4*e+2],n=0,c=128===(128&r),h=64===(64&r),o=(3&r)<<2,l=this.getSpriteSize();0===this.fSpriteSize?n=this.fSpriteTable:(n=1&a,a&=254),(i=c?l-1-i:i)>7&&(a++,i%=8),s=4096*n+16*a+i,this.lowTileByte=this.memory.read8(s),this.highTileByte=this.memory.read8(s+8),this.readTileRow(t,o,this.lowTileByte,this.highTileByte,h,!0)}},{key:"fetchAndStoreSpriteRows",value:function(){var t,e,i;this.spriteCount=0;for(var s=this.getSpriteSize(),a=0;a<64;a++)if(t=this.memory.oam[4*a+0],!((i=this.scanline-t)<0||i>=s)&&(this.spriteCount<8&&(e=this.memory.oam[4*a+2],this.fetchSpriteRow(this.sprites[this.spriteCount].buffer,a,i),this.sprites[this.spriteCount].x=this.memory.oam[4*a+3],this.sprites[this.spriteCount].priority=e>>5&1,this.sprites[this.spriteCount].index=a),this.spriteCount++,this.spriteCount>8)){this.spriteCount=8,this.fSpriteOverflow=1;break}}},{key:"fetchAndStoreBackgroundRow",value:function(){var t,e,i,s;t=8192|4095&this.v,s=this.memory.read8(t),t=9152|3072&this.v|this.v>>4&56|this.v>>2&7,e=this.v>>4&4|2&this.v,this.attributeTableByte=(this.memory.read8(t)>>e&3)<<2,i=this.v>>12&7,t=4096*this.fBackgroundTable+16*s+i,this.lowTileByte=this.memory.read8(t),i=this.v>>12&7,t=4096*this.fBackgroundTable+16*s+i,this.highTileByte=this.memory.read8(t+8),this.readTileRow(this.backgroundTileBuffer,this.attributeTableByte,this.lowTileByte,this.highTileByte,!1,!1)}},{key:"_cycleType",value:function(){return 0===this.cycle?Z:1===this.cycle?G:this.cycle>1&&this.cycle<257?z:321===this.cycle?W:this.cycle>321&&this.cycle<337?Y:259===this.cycle?V:258===this.cycle?J:257===this.cycle?K:this.cycle>279&&this.cycle<305?q:340===this.cycle?Q:H}},{key:"_scanlineType",value:function(){return this.scanline<240?tt:241===this.scanline?et:261===this.scanline?$:it}},{key:"doPreline",value:function(){if(this.cycleType!==G&&this.cycleType!==z&&this.cycleType!==Y||(this.backgroundTileBuffer.shift(),this.cycle%8===0&&(this.cycle<256&&this.fetchAndStoreBackgroundRow(),this.updateScrollingX())),this.cycleType===V&&(this.spriteCount=0),this.cycleType===q&&(this.v=33823&this.v|31712&this.t),this.updateScrollingY(),this.cycleType===G&&this.clearVerticalBlank(),this.cycleType===Q&&this.memory.mapper.tick())return T}},{key:"doVisibleLine",value:function(){return this.cycleType!==G&&this.cycleType!==z||this.renderPixel(),this.cycleType===z?(this.backgroundTileBuffer.shift(),this.cycle%8===0&&(this.cycle<256&&this.fetchAndStoreBackgroundRow(),this.updateScrollingX())):this.cycleType===W?this.backgroundTileBuffer.length=0:this.cycleType===Y&&this.cycle%8===0&&(this.fetchAndStoreBackgroundRow(),this.updateScrollingX()),this.updateScrollingY(),this.cycleType===V&&this.fetchAndStoreSpriteRows(),this.cycleType===Q&&this.memory.mapper.tick()?T:null}},{key:"doVBlankLine",value:function(){return this.cycleType===V&&(this.spriteCount=0),this.cycleType===G&&(this.setVerticalBlank(),this.nmiOutput)?S:null}},{key:"incrementCounters",value:function(){this.cycle++,261===this.scanline&&340===this.cycle&&0!==this.fShowBackground&&1===this.f&&(this.cycle++,this.f=1^this.f),341===this.cycle&&(this.cycle=0,this.scanline++,262===this.scanline&&(this.scanline=0))}},{key:"tick",value:function(){return this.cycleType=this._cycleType(),this.scanlineType=this._scanlineType(),this.scanlineType===et?this.interrupt=this.doVBlankLine():0!==this.fShowBackground||0!==this.fShowSprites?this.scanlineType===$?this.interrupt=this.doPreline():this.scanlineType===tt&&(this.interrupt=this.doVisibleLine()):this.interrupt=null,this.incrementCounters(),this.interrupt}}]),t}(),dt=function(){function t(e,i,s){Object(f.a)(this,t),this.data=e,this.swapMode=0,this.windowSize=i,this.bankNbr=parseInt(this.data.length/1024),this.pointers=new Array(parseInt(i/1024)).fill(0),this.bankSize=s,this.p=0,this.o=0,this.p1=0,this.p2=0;for(var a=0;a<this.pointers.length;a++)this.pointers[a]=a}return Object(p.a)(t,[{key:"setBankSize",value:function(t){this.bankSize=t}},{key:"switchBank",value:function(t,e,i){this.p1=parseInt(t/1024),this.p2=parseInt(e/1024),i<0&&(i=this.bankNbr/this.bankSize+i),i*=this.p2-this.p1;for(var s=0,a=this.p1;a<this.p2;a++,s++)this.pointers[a]=i+s}},{key:"write8",value:function(t,e){this.p=parseInt(t/1024),this.o=t%1024,this.data[1024*this.pointers[this.p]+this.o]=e}},{key:"read8",value:function(t){return this.p=parseInt(t/1024),this.o=t%1024,this.data[1024*this.pointers[this.p]+this.o]}}]),t}(),yt=function(){function t(e){Object(f.a)(this,t),this.chr=new dt(e.chr,8192,8),this.prg=new dt(e.prg,32768,16),this.sram=new Array(8192).fill(255),this.mirrorType=e.mirrorType}return Object(p.a)(t,[{key:"tick",value:function(){}}]),t}(),gt=function(t){function e(t){var i;return Object(f.a)(this,e),(i=Object(d.a)(this,Object(y.a)(e).call(this,t))).prg.switchBank(16384,32768,-1),i}return Object(g.a)(e,t),Object(p.a)(e,[{key:"read8",value:function(t){return t<8192?this.chr.read8(t):t<32768?this.sram[t-24576]:this.prg.read8(t-32768)}},{key:"write8",value:function(t,e){t<8192?this.chr.write8(t,e):t<32768?this.sram[t-24576]=e:console.warn("Invalid write addr",t)}}]),e}(yt),mt=0,bt=1,vt={0:2,1:3,2:bt,3:mt},Et=function(t){function e(t){var i;return Object(f.a)(this,e),(i=Object(d.a)(this,Object(y.a)(e).call(this,t))).buffer=16,i.bufferIndex=0,i.conf=12,i.prgBankMode=0,i.chrBankMode=0,i.prg.switchBank(16384,32768,-1),i}return Object(g.a)(e,t),Object(p.a)(e,[{key:"read8",value:function(t){return t<8192?this.chr.read8(t):t<32768?this.sram[t-24576]:this.prg.read8(t-32768)}},{key:"write8",value:function(t,e){t<8192?this.chr.write8(t,e):t<32768?this.sram[t-24576]=e:0!==(128&e)?(this.buffer=16,this.bufferIndex=0,this.control(12|this.conf)):(this.buffer=this.buffer>>1|(1&e)<<4,this.bufferIndex++,5===this.bufferIndex&&(e=this.buffer,t<40960?this.control(e):t<49152?this.chr.fixed?(e=parseInt(e>>1),this.chr.switchBank(0,8192,e)):this.chr.switchBank(0,4096,e):t<57344?this.chr.fixed||this.chr.switchBank(4096,8192,e):this.prg.fixed?(e=parseInt(e>>1),this.prg.switchBank(0,32768,e)):0===this.prg.swapMode?(this.prg.switchBank(0,16384,0),this.prg.switchBank(16384,32768,e)):(this.prg.switchBank(0,16384,e),this.prg.switchBank(16384,32768,-1)),this.buffer=16,this.bufferIndex=0))}},{key:"control",value:function(t){this.conf=t,this.prgBankMode=t>>2&3,this.chrBankMode=t>>4&1,this.mirrorType=vt[3&t],2===this.prgBankMode&&(this.prg.swapMode=0),3===this.prgBankMode&&(this.prg.swapMode=1),this.prg.fixed=0===this.prgBankMode||1===this.prgBankMode,this.chr.fixed=0===this.chrBankMode}}]),e}(yt),kt={0:bt,1:mt},Ot=function(t){function e(t){var i;return Object(f.a)(this,e),(i=Object(d.a)(this,Object(y.a)(e).call(this,t))).prgBankMode=0,i.chrBankMode=0,i.bankRegister=0,i.irqCounter=0,i.irqLatch=0,i.irqEnable=!0,i.prg.setBankSize(8),i.prg.switchBank(16384,24576,-2),i.prg.switchBank(24576,32768,-1),i.prg.switchBank(0,8192,0),i.prg.switchBank(8192,16384,1),i}return Object(g.a)(e,t),Object(p.a)(e,[{key:"tick",value:function(){if(0===this.irqCounter)this.irqCounter=this.irqLatch;else if(this.irqCounter--,0===this.irqCounter&&this.irqEnable)return!0;return!1}},{key:"read8",value:function(t){return t<8192?this.chr.read8(t):t<32768?this.sram[t-24576]:this.prg.read8(t-32768)}},{key:"write8",value:function(t,e){t<8192?this.chr.write8(t,e):t<32768?this.sram[t-24576]=e:this.control(t,e)}},{key:"control",value:function(t,e){var i=t%2===0;if(t<40959&&i)this.prgBankMode=e>>6&1,this.chrBankMode=e>>7&1,this.bankRegister=7&e;else if(t<40960&&!i)switch(this.bankRegister){case 0:0===this.chrBankMode?(this.chr.switchBank(0,1024,254&e),this.chr.switchBank(1024,2048,1|e)):(this.chr.switchBank(4096,5120,254&e),this.chr.switchBank(5120,6144,1|e));break;case 1:0===this.chrBankMode?(this.chr.switchBank(2048,3072,254&e),this.chr.switchBank(3072,4096,1|e)):(this.chr.switchBank(6144,7168,254&e),this.chr.switchBank(7168,8192,1|e));break;case 2:0===this.chrBankMode?this.chr.switchBank(4096,5120,e):this.chr.switchBank(0,1024,e);break;case 3:0===this.chrBankMode?this.chr.switchBank(5120,6144,e):this.chr.switchBank(1024,2048,e);break;case 4:0===this.chrBankMode?this.chr.switchBank(6144,7168,e):this.chr.switchBank(2048,3072,e);break;case 5:0===this.chrBankMode?this.chr.switchBank(7168,8192,e):this.chr.switchBank(3072,4096,e);break;case 6:0===this.prgBankMode?(this.prg.switchBank(16384,24576,-2),this.prg.switchBank(0,8192,e)):(this.prg.switchBank(0,8192,-2),this.prg.switchBank(16384,24576,e));break;case 7:this.prg.switchBank(8192,16384,e),0===this.prgBankMode?this.prg.switchBank(16384,24576,-2):this.prg.switchBank(0,8192,-2)}else if(t<49151&&i)this.mirrorType=kt[1&e];else if(t<49152&&!i);else if(t<57343&&i)this.irqLatch=e;else if(t<57344&&!i)this.irqCounter=0;else if(t<65535&&i)this.irqEnable=!1;else{if(!(t<65536)||i)throw new Error("Unknown control: "+t);this.irqEnable=!0}}}]),e}(yt),St=function(t){function e(t){var i;return Object(f.a)(this,e),(i=Object(d.a)(this,Object(y.a)(e).call(this,t))).prg.switchBank(16384,32768,-1),i}return Object(g.a)(e,t),Object(p.a)(e,[{key:"read8",value:function(t){return t<8192?this.chr.read8(t):t<32768?this.sram[t-24576]:this.prg.read8(t-32768)}},{key:"write8",value:function(t,e){t<8192?this.chr.write8(t,e):t<32768?this.sram[t-24576]=e:this.prg.switchBank(0,16384,15&e)}}]),e}(yt),Tt=function(t){function e(t){var i;return Object(f.a)(this,e),(i=Object(d.a)(this,Object(y.a)(e).call(this,t))).prg.switchBank(16384,32768,-1),i}return Object(g.a)(e,t),Object(p.a)(e,[{key:"read8",value:function(t){return t<8192?this.chr.read8(t):t<32768?this.sram[t-24576]:this.prg.read8(t-32768)}},{key:"write8",value:function(t,e){t<8192?this.chr.write8(t,e):t<32768?this.sram[t-24576]=e:this.chr.switchBank(0,8192,15&e)}}]),e}(yt),wt=function t(e){Object(f.a)(this,t);var i=0,s=new Uint8Array(e);this.header=s.subarray(i,16),i+=16,this.nbrPRGBanks=this.header[4],this.nbrCHRBanks=this.header[5],this.mapperType=this.header[6]>>4|this.header[7]>>4<<4,this.mirrorType=1&this.header[6]|(this.header[6]>>3&1)<<1,this.region=1&this.header[9];var a=16384*this.nbrPRGBanks,r=8192*this.nbrCHRBanks;switch(this.prg=s.subarray(i,i+a),i+=a,this.chr=r>0?s.subarray(i,i+r):new Uint8Array(8192).fill(0),this.mapperType){case 0:this.mapper=new gt(this);break;case 1:this.mapper=new Et(this);break;case 2:this.mapper=new St(this);break;case 3:this.mapper=new Tt(this);break;case 4:this.mapper=new Ot(this);break;default:throw new Error("Invalid mapper: "+this.mapperType)}},At=function(){function t(){Object(f.a)(this,t)}return Object(p.a)(t,[{key:"write8",value:function(t,e){}},{key:"read8",value:function(){return 255}},{key:"tick",value:function(){}}]),t}(),Ct=function(){function t(){Object(f.a)(this,t),this.buttons=new Array(8).fill(0),this.strobe=0,this.i=0,document.addEventListener("keydown",this.keyDown.bind(this)),document.addEventListener("keyup",this.keyUp.bind(this))}return Object(p.a)(t,[{key:"_checkInput",value:function(t,e){switch(t.keyCode){case B:this.buttons[M]=e;break;case C:this.buttons[_]=e;break;case w:this.buttons[D]=e;break;case A:this.buttons[j]=e;break;case L:this.buttons[X]=e,t.preventDefault();break;case I:this.buttons[N]=e,t.preventDefault();break;case P:this.buttons[U]=e,t.preventDefault();break;case R:this.buttons[x]=e,t.preventDefault()}}},{key:"keyDown",value:function(t){this._checkInput(t,1)}},{key:"keyUp",value:function(t){this._checkInput(t,0)}},{key:"write8",value:function(t){this.strobe=t,1===(1&this.strobe)&&(this.i=0)}},{key:"read8",value:function(){var t=this.buttons[this.i];return this.i++,t}}]),t}();function Bt(t){return t&&"object"===typeof t&&!Array.isArray(t)}var It=function(){function t(){Object(f.a)(this,t),this.observers=[]}return Object(p.a)(t,[{key:"addObserver",value:function(t){this.observers.push(t)}},{key:"removeObserver",value:function(t){this.observers=this.observers.filter(function(e){return e!==t})}},{key:"notifyObservers",value:function(t,e){this.observers.forEach(function(i){return i.notify(t,e)})}}]),t}(),Rt=function(){function t(e){Object(f.a)(this,t),this.fpsInterval=1e3/e,this.now=null,this.elapsed=null,this.then=null}return Object(p.a)(t,[{key:"isThrottled",value:function(){return this.now=Date.now(),this.elapsed=this.now-this.then,!(this.elapsed>this.fpsInterval)||(this.then=this.now-this.elapsed%this.fpsInterval,!1)}}]),t}(),Lt=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return Object(f.a)(this,e),(t=Object(d.a)(this,Object(y.a)(e).call(this))).cpu=new ot,t.ppu=new pt,t.apu=new At,t.controller=new Ct,t.rom=null,t.cycles=0,t.interrupt=null,t.quickSaveData=null,t.cpu.connect(t.apu,t.ppu,t.controller),t.frameReq=null,t.frameThrottling=i?new Rt(i):null,t.nesThrottling=new Rt(60),t.frameNbr=0,t.opCodesKeys=Object.keys(O),t.modeKeys=Object.keys(k),t}return Object(g.a)(e,t),Object(p.a)(e,[{key:"loadROM",value:function(t){this.rom=new wt(t),this.ppu.connectROM(this.rom),this.reset()}},{key:"reset",value:function(){this.cpu.reset(),this.ppu.reset(),this.notifyObservers("nes-reset",this.ppu.frameBuffer)}},{key:"quickSave",value:function(){var t=JSON.parse(JSON.stringify(this.cpu));t.ppu.frameBuffer=[],t.ppu.frameBackgroundBuffer=[],t.ppu.frameSpriteBuffer=[],t.ppu.frameColorBuffer=[],t.ppu.patternTable1=[],t.ppu.patternTable2=[],this.notifyObservers("nes-quick-save"),localStorage.quickSave=JSON.stringify(t)}},{key:"loadQuickSave",value:function(t){localStorage.quickSave&&(this.cpu=function t(e){for(var i=arguments.length,s=new Array(i>1?i-1:0),a=1;a<i;a++)s[a-1]=arguments[a];if(!s.length)return e;var r=s.shift();if(Bt(e)&&Bt(r))for(var n in r)Bt(r[n])?(e[n]||Object.assign(e,Object(at.a)({},n,{})),t(e[n],r[n])):Object.assign(e,Object(at.a)({},n,r[n]));return t.apply(void 0,[e].concat(s))}(this.cpu,JSON.parse(localStorage.quickSave)),this.cpu.ppu.resetBuffers(),this.notifyObservers("nes-load-quick-save"))}},{key:"start",value:function(){this._tick=this.tick,this.frameReq=requestAnimationFrame(this.frame.bind(this))}},{key:"startSync",value:function(){for(var t=0;;)if(null===this.nesThrottling||!this.nesThrottling.isThrottled())for(;1!==(t=this.tick());)if(-1===t)return void this.stop()}},{key:"startDebug",value:function(){this._tick=this.tickDebug,this.frameReq=requestAnimationFrame(this.frame.bind(this))}},{key:"stop",value:function(){cancelAnimationFrame(this.frameReq)}},{key:"tickDebug",value:function(){for(this.cycles=this.cpu.tick(),this.cycles=3*this.cycles,this.notifyObservers("cpu-tick",[this.cpu.instrCode,this.opCodesKeys[this.cpu.instrOpCode],this.modeKeys[this.cpu.instrMode],this.cpu.instrSize,this.cpu.instrCycles,this.cpu.addr]);this.cycles>0;this.cycles--)if(this.interrupt=this.ppu.tick(),null!==this.interrupt&&(this.interrupt===S?this.cpu.triggerNMI():this.interrupt===T&&this.cpu.triggerIRQ()),this.notifyObservers("ppu-tick"),this.ppu.frameReady)return this.notifyObservers("frame-ready",this.ppu.frameBuffer),this.notifyObservers("frame-ready-debug"),this.ppu.acknowledgeFrame(),this.frameNbr++,!1;return!0}},{key:"tick",value:function(){if(this.cycles=this.cpu.tick(),-1===this.cycles)return-1;for(var t=this.cycles;t>0;t--)this.apu.tick();for(var e=3*this.cycles;e>0;e--)if(this.interrupt=this.ppu.tick(),null!==this.interrupt&&(this.interrupt===S?this.cpu.triggerNMI():this.interrupt===T&&this.cpu.triggerIRQ()),this.ppu.frameReady)return this.frameThrottling.isThrottled()||this.notifyObservers("frame-ready",[this.ppu.frameBuffer,this.ppu.frameBackgroundBuffer,this.ppu.frameSpriteBuffer,this.ppu.frameColorBuffer]),this.ppu.acknowledgeFrame(),1;return 0}},{key:"frame",value:function(){var t=0;if(null===this.nesThrottling||!this.nesThrottling.isThrottled())for(;1!==(t=this._tick());)if(-1===t)return void this.stop();this.frameReq=requestAnimationFrame(this.frame.bind(this))}}]),e}(It),Pt=function(t){function e(t){var i;return Object(f.a)(this,e),(i=Object(d.a)(this,Object(y.a)(e).call(this,t))).getStyle=function(t){return"You"===t?{backgroundColor:"#FFDAB9",overflowY:"auto",opacity:.75}:{backgroundColor:"#FFD700",overflowY:"auto",opacity:.75}},i.determineVisualContent=function(t,e){if("undefined"==typeof t||null==typeof t)return null;if(t.length<=0)return null;var s=t.split("/");if("files.catbox.moe"===s[2]||"i.imgur.com"===s[2])return"mp4"==(s=s[3].split("."))[1]||"webm"==s[1]||"avi"==s[1]||"ogg"==s[1]||"mpeg"==s[1]?r.a.createElement("div",null,r.a.createElement("br",null),r.a.createElement("video",{ref:function(t){i.vidRef=t},onLoadedMetadata:i.scrollToBottomVideo,controls:!0,autoplay:!0}," ",r.a.createElement("source",{src:t}))," "):"jpg"==s[1]||"jpeg"==s[1]||"png"==s[1]||"gif"==s[1]?r.a.createElement("div",null,r.a.createElement("br",null),r.a.createElement("img",{src:t,alt:"User Content"})):"nes"==s[1]?(i.console.loadROM(t),i.console.start(),r.a.createElement("div",null,r.a.createElement("canvas",{ref:function(t){i.clientNesRef=t},style:{height:300,width:400}}," "))):null;if("www.youtube.com"===s[2]||"youtube.com"===s[2]||"youtu.be"===s[2]||"www.youtu.be"===s[2]){var a="https://youtube.com/embed/"+s[3].replace(/^.*(watch\?v=)/,"");return r.a.createElement("div",null,r.a.createElement("iframe",{width:"560",height:"315",src:a,frameborder:"0",allow:"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:!0}))}return null},i.hoverOn=function(){i.chatRef.style.opacity=1},i.hoverOff=function(){i.chatRef.style.opacity=.75},i.scrollToBottom=function(){i.chatRef.scrollIntoView({behavior:"smooth",block:"start"})},i.scrollToBottomVideo=function(){i.vidRef.scrollIntoView({behavior:"smooth",block:"start"})},i.console=new Lt,i.console.addObserver(Object(m.a)(Object(m.a)(i))),i}return Object(g.a)(e,t),Object(p.a)(e,[{key:"componentDidMount",value:function(){this.scrollToBottom()}},{key:"componentDidUpdate",value:function(){this.scrollToBottom()}},{key:"render",value:function(){var t=this;return r.a.createElement("div",{onMouseEnter:this.hoverOn,onMouseLeave:this.hoverOff,style:this.getStyle(this.props.chatItems.user),ref:function(e){t.chatRef=e}},this.props.chatItems.user+": "+this.props.chatItems.message,this.determineVisualContent(this.props.chatItems.message))}}]),e}(a.Component),Dt=function(t){function e(){return Object(f.a)(this,e),Object(d.a)(this,Object(y.a)(e).apply(this,arguments))}return Object(g.a)(e,t),Object(p.a)(e,[{key:"render",value:function(){return this.props.chatMessages.map(function(t){return r.a.createElement(Pt,{key:t.id,chatItems:t})})}}]),e}(a.Component),jt=function(t){function e(){var t,i;Object(f.a)(this,e);for(var s=arguments.length,a=new Array(s),r=0;r<s;r++)a[r]=arguments[r];return(i=Object(d.a)(this,(t=Object(y.a)(e)).call.apply(t,[this].concat(a)))).overlay=function(){i.overlayRef.style.display="none"},i}return Object(g.a)(e,t),Object(p.a)(e,[{key:"componentDidMount",value:function(){(window.adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-4945903400451091",enable_page_level_ads:!0})}},{key:"render",value:function(){var t=this;return r.a.createElement("div",{id:"overlay",ref:function(e){t.overlayRef=e}},r.a.createElement("p",null,"Please check the ",r.a.createElement("b",null,"TOP RIGHT")," (in Chrome) ",r.a.createElement("b",null,"TOP LEFT")," (in Firefox) of your browser and make sure your webcam/mic is accessible to the browser!",r.a.createElement("br",null)),r.a.createElement("p",null,"Welcome to Random.moe!"),r.a.createElement("p",null,"Random.moe is an ",r.a.createElement("a",{href:"https://github.com/openpgpjs/openpgpjs"},"encrypted"),", ",r.a.createElement("a",{href:"https://github.com/feross/simple-peer"},"peer-to-peer"),", ",r.a.createElement("a",{href:"https://github.com/paradoxmoe/paradox"},"open source")," random chat alternative to Omegle/Chatroulette/etc."),r.a.createElement("p",null,"Special thanks to: ",r.a.createElement("a",{href:"http://stackoverflow.com/a/35387759"},"Kecer")," on Stackoverflow and ",r.a.createElement("a",{href:"https://codepen.io/Anomaly942/"},"Kaustav")," on CodePen"),r.a.createElement("p",null,"Youtube Support! Just Copy and Paste a youtube URL into the chat!"),r.a.createElement("p",null,"Imgur support! "),r.a.createElement("p",null,r.a.createElement("a",{href:"http://catbox.moe"},"Catbox")," Support! Just Copy and Paste a Catbox.moe URL into the chat! (Images and videos!) "),r.a.createElement("p",null,"As the site is currently in Early Access, please report bugs or other issues ",r.a.createElement("a",{href:"https://github.com/paradoxmoe/RandomMOE/issues"},"here"),"!"),r.a.createElement("p",null,"Furthermore, as you are talking to random and anonymous users, please exercise caution when using this platform."),r.a.createElement("p",null,"We use cookies/local storage to store your PGP encryption keys, so be aware of this."),r.a.createElement("p",null,"If you'd like to contribute to the success of random.moe, please visit our ",r.a.createElement("a",{href:"https://www.patreon.com/randomMOE"},"Patreon"),"!"),r.a.createElement("button",{onClick:this.overlay},"Click here if you've read the above!"),r.a.createElement("ins",{className:"adsbygoogle",style:{display:"block",width:"970px",height:"250px"},"data-ad-client":"ca-pub-4945903400451091","data-ad-slot":"3171544049"}))}}]),e}(a.Component),_t=function(t){function e(){var t,i;Object(f.a)(this,e);for(var s=arguments.length,a=new Array(s),r=0;r<s;r++)a[r]=arguments[r];return(i=Object(d.a)(this,(t=Object(y.a)(e)).call.apply(t,[this].concat(a)))).state={content:""},i.onChange=function(t){return i.setState({content:t.target.value})},i.onSubmit=function(t){t.preventDefault(),i.props.createMessage("You",i.state.content),i.setState({content:"",user:"You"})},i}return Object(g.a)(e,t),Object(p.a)(e,[{key:"render",value:function(){return r.a.createElement("form",{onSubmit:this.onSubmit,style:{position:"fixed",bottom:"0",width:"100%"}},r.a.createElement("input",{type:"text",name:"title",style:{flex:"10",padding:"5px",width:"90%"},placeholder:"Type Message Here...",value:this.state.content,onChange:this.onChange}),r.a.createElement("input",{type:"submit",value:"submit",className:"btn",style:{flex:"1"}}))}}]),e}(a.Component),Mt=(i(79),function(t){function e(t){var i;return Object(f.a)(this,e),(i=Object(d.a)(this,Object(y.a)(e).call(this,t))).lineGradient=function(t,e,s,a,r,n){var c=i.ctx.createLinearGradient(t,e,s,a);return c.addColorStop(0,r),c.addColorStop(1,n),c},i.radialGradient=function(t,e,s,a,r,n,c,h){var o=i.ctx.createRadialGradient(t,e,s,a,r,n,c,h);return o.addColorStop(0,c),o.addColorStop(1,h),o},i.rand=function(t,e){return Math.ceil(Math.random()*(e-t)+t)},i.canvasSize=function(){i.canvasRef.width=i.state.width,i.canvasRef.height=i.state.height},i.fill=function(t){i.fillcolor=t},i.stroke=function(t){i.strokecolor=t},i.border=function(t){i.strokesize=t},i.rect=function(t,e,s,a){i.ctx.fillStyle=i.fillcolor,i.ctx.strokeStyle=i.strokecolor,i.ctx.lineWidth=i.strokesize,i.ctx.beginPath(),i.ctx.rect(t,e,s,a),i.ctx.fill(),i.ctx.stroke(),i.ctx.closePath()},i.circle=function(t,e,s){i.ctx.fillStyle=i.fillcolor,i.ctx.strokeStyle=i.strokecolor,i.ctx.lineWidth=i.strokesize,i.ctx.beginPath(),i.ctx.arc(t,e,s,0,2*Math.PI,!1),i.ctx.fill(),i.ctx.stroke(),i.ctx.closePath()},i.point=function(t,e){i.ctx.fillStyle=i.fillcolor,i.ctx.strokeStyle=i.strokecolor,i.ctx.lineWidth=i.strokeSize,i.ctx.beginPath(),i.ctx.rect(t,e,1,1),i.ctx.fill(),i.ctx.stroke(),i.ctx.closePath()},i.canvasBackgroundFill=function(){i.fill(i.lineGradient(i.state.width/1,0,i.state.width/2,1.3*i.state.height,"#200030","#9c046e")),i.rect(0,0,i.state.width,i.state.height)},i.stars=function(){i.stroke("#ffffff"),i.border(1.5*Math.min(i.state.width/1440,i.state.height/900));for(var t=0;t<i.state.width/1.5;t++)i.point(i.rand(0,i.state.width),i.rand(0,i.state.width));i.stroke("#ffffff00")},i.sun=function(){var t=400*Math.min(i.state.width/1440,i.state.height/900);i.fill(i.lineGradient(i.state.width/2,0,i.state.width/2,1.1*i.state.height,"#ff4400","#ffff00")),i.circle(i.state.width/2,i.state.height/2,t)},i.water=function(){i.fill(i.radialGradient(i.state.width/2,i.state.height*(2/3),i.state.width/1440*100,i.state.width/2,i.state.height*(2/3),i.state.height/900*600,"#002244cc","#000044cc")),i.rect(0,i.state.height*(2/3),i.state.width,i.state.height/3)},i.onResize=function(){i.setState({width:window.innerWidth,height:window.innerHeight}),i.canvasSize(),i.createCanvasBackground()},i.createCanvasBackground=function(){i.canvasBackgroundFill(),i.stars(),i.sun(),i.water()},i.fillcolor="#000000",i.strokecolor="#000000",i.strokesize="#000000",i.state={width:window.innerWidth,height:window.innerHeight},i}return Object(g.a)(e,t),Object(p.a)(e,[{key:"componentWillMount",value:function(){}},{key:"componentDidMount",value:function(){this.ctx=this.canvasRef.getContext("2d"),this.setState({width:window.innerWidth,height:window.innerHeight}),window.addEventListener("resize",this.onResize),this.onResize(),this.createCanvasBackground()}},{key:"componentDidUpdate",value:function(){this.createCanvasBackground()}},{key:"render",value:function(){var t=this;return r.a.createElement("canvas",{ref:function(e){t.canvasRef=e}})}}]),e}(a.Component)),Nt=i(12),xt=(i(117),i(68)),Xt=i.n(xt),Ut=i(69),Ft=i.n(Ut);if(Nt.initWorker({path:"./dist/openpgp.worker.min.js"}),"undefined"==typeof localStorage.publicKey||"undefined"==typeof localStorage.privateKey||"undefined"==typeof localStorage.pass){var Zt=new Uint32Array(4);window.crypto.getRandomValues(Zt),localStorage.pass=Zt[2].toString();var Gt={userIds:[{name:Zt[3].toString(),email:Zt[0]+"@"+Zt[1]+".com"}],numBits:2048,passphrase:localStorage.pass};Nt.generateKey(Gt).then(function(t){localStorage.setItem("privateKey",t.privateKeyArmored),localStorage.setItem("publicKey",t.publicKeyArmored)})}var Yt=function(t){function e(t){var i;return Object(f.a)(this,e),(i=Object(d.a)(this,Object(y.a)(e).call(this,t))).socketConnection=function(t){var e=Ft.a.connect("https://random.moe");i.setState({chatMessages:[].concat(Object(u.a)(i.state.chatMessages),[{id:i.state.chatMessages.length,user:"Client",message:"Connecting to Server..."}])}),e.on("peer",function(s){i.createPeer(s.initiator,t),console.log("Server told client to become initiator: "+s.initiator),s.initiator&&i.state.peer.on("signal",function(t){e.emit("initiatorData",t),i.setState({chatMessages:[].concat(Object(u.a)(i.state.chatMessages),[{id:i.state.chatMessages.length,user:"Client",message:"Emitting Initiator data to Server..."}])})})}),e.on("joinInitiator",function(t){if(i.setState({chatMessages:[].concat(Object(u.a)(i.state.chatMessages),[{id:i.state.chatMessages.length,user:"Client",message:"Joining Initiator..."}])}),i.state.peer.signal(t.data),!t.initiator){var s=t.socketid;i.state.peer.on("signal",function(t){e.emit("backToInitiator",{socketid:s,data:t}),i.setState({chatMessages:[].concat(Object(u.a)(i.state.chatMessages),[{id:i.state.chatMessages.length,user:"Client",message:"Recieving Initiator's Data..."}])})})}}),e.on("toInitiatorFromServer",function(t){i.state.peer.signal(t.data),i.setState({chatMessages:[].concat(Object(u.a)(i.state.chatMessages),[{id:i.state.chatMessages.length,user:"Client",message:"Connecting to Peer..."}])})})},i.submitButton=function(){console.log("Can Submit")},i.next=function(){i.setState({chatMessages:[].concat(Object(u.a)(i.state.chatMessages),[{id:i.state.chatMessages.length,user:"Client",message:"Finding User..."}])}),null!=i.state.peer&&"undefined"!=typeof i.state.peer&&(i.state.peer.destroy(),i.setState({chatMessages:[],peerInfo:null,stream:null,peer:null,inConvo:!1})),navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then(function(t){i.socketConnection(t)})},i.createPeer=function(t,e){var s=new Xt.a({initiator:t,trickle:!1,stream:e});return i.setState({inConvo:!0}),s.on("connect",function(){s.send(JSON.stringify({isPublicKey:!0,peerPublicKey:localStorage.publicKey})),i.setState({chatMessages:[]})}),s.on("data",function(){var t=Object(l.a)(o.a.mark(function t(e){var s,a;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!0!==(e=JSON.parse(e)).isPublicKey){t.next=7;break}localStorage.setItem("peerPublicKey",e.peerPublicKey),console.log("Public Key Recieved!"),i.setState({chatMessages:[{id:i.state.chatMessages.length,user:"Client",message:"You can now send messages!"}]}),t.next=18;break;case 7:return t.next=9,Nt.key.readArmored(localStorage.privateKey);case 9:return s=t.sent.keys[0],t.next=12,s.decrypt(localStorage.pass);case 12:return t.next=14,Nt.message.readArmored(e.data);case 14:t.t0=t.sent,t.t1=[s],a={message:t.t0,privateKeys:t.t1},Nt.decrypt(a).then(function(t){var s={id:i.state.chatMessages.length,user:e.user,message:t.data};i.setState({chatMessages:[].concat(Object(u.a)(i.state.chatMessages),[s])})});case 18:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()),s.on("stream",function(t){i.setState({peerStream:t}),i.peerRef.srcObject=i.state.peerStream,i.peerRef.onloaddedmetadata=i.peerRef.play()}),i.setState({peer:s,inConvo:!0}),s},i.createMessage=function(){var t=Object(l.a)(o.a.mark(function t(e,s){var a,r,n;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a={id:i.state.chatMessages.length,user:e,message:s},i.setState({chatMessages:[].concat(Object(u.a)(i.state.chatMessages),[a])}),r=Nt.message.fromText(s),t.t0=r,t.next=6,Nt.key.readArmored(localStorage.peerPublicKey);case 6:t.t1=t.sent.keys,n={message:t.t0,publicKeys:t.t1},Nt.encrypt(n).then(function(t){var e=t.data;i.state.peer.send(JSON.stringify({user:"Anon",data:e}))});case 9:case"end":return t.stop()}},t)}));return function(e,i){return t.apply(this,arguments)}}(),i.state={chatMessages:[],peerInfo:null,stream:null,peer:null,inConvo:!1},i}return Object(g.a)(e,t),Object(p.a)(e,[{key:"componentDidMount",value:function(){var t=this;navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then(function(e){t.clientRef.srcObject=e,t.clientRef.onloaddedmetadata=t.clientRef.play(),t.forceUpdate()})}},{key:"render",value:function(){var t=this;return r.a.createElement("div",{className:"App"},r.a.createElement(jt,null),r.a.createElement("div",{id:"videoChat"},r.a.createElement("div",null,r.a.createElement("h3",{id:"logo"},"Random.moe")," ",r.a.createElement("a",{href:"https://www.patreon.com/randomMOE"},"Patreon")," | ",r.a.createElement("a",{href:"https://twitter.com/Twitch_NotDem"},"Twitter")," | ",r.a.createElement("a",{href:"https://twitch.tv/notdem"},"Twitch")," | ",r.a.createElement("a",{href:"https://github.com/paradoxmoe/RandomMOE"},"Github")),r.a.createElement("video",{ref:function(e){t.clientRef=e},controls:!0,muted:!0}),r.a.createElement("video",{ref:function(e){t.peerRef=e},controls:!0})),r.a.createElement("div",{id:"chatApp",class:"disableScrollbars"},r.a.createElement(Dt,{chatMessages:this.state.chatMessages,submit:this.submitButton}),r.a.createElement("button",{type:"button",onClick:this.next,ref:function(e){t.findUsers=e}},"Next")),r.a.createElement(_t,{createMessage:this.createMessage,peer:this.peer}),r.a.createElement(Mt,null))}}]),e}(a.Component);c.a.render(r.a.createElement(Yt,null),document.getElementById("root"))},70:function(t,e,i){t.exports=i(153)},75:function(t,e,i){},83:function(t,e){},85:function(t,e){}},[[70,1,2]]]);
//# sourceMappingURL=main.18ae7be4.chunk.js.map